---
import { getCollection, type CollectionEntry } from 'astro:content';
import BlogPostLayout from '../../layouts/BlogPostLayout.astro';
import BlogPost from '../../components/BlogPost.astro';

type BlogPost = CollectionEntry<'blog'>;

// 1️⃣ Export getStaticPaths for the dynamic route
export async function getStaticPaths() {
  const posts: BlogPost[] = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id }, // 'id' is the filename w/o extension
  }));
}

// 2️⃣ Find the matching post
const { slug } = Astro.params;
const post = (await getCollection('blog')).find((p) => p.id === slug);

if (!post) {
  throw new Error(`Post not found: ${slug}`);
}
---

<!-- 3️⃣ Wrap everything in BlogPostLayout, pass the post's title as a prop -->
<BlogPostLayout title={post.data.title}>
  <!-- 4️⃣ Use a separate component to display the post content -->
  <BlogPost post={post} />
</BlogPostLayout>
